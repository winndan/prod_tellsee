ğŸ”¹ Phase 4 â€” Controller / Orchestration
ğŸ¯ Purpose

Coordinate the full pipeline in a safe, repeatable, cacheable way.

ğŸ“¥ Entry Points

handle_request(raw_text)

handle_request_from_business(business_id)

âš™ï¸ Pipeline Flow
Input
 â†“
Validation
 â†“
Phase 2 â€” Extract Signals
 â†“
Hash + Cache
 â†“
Phase 1 â€” Decide Strategy
 â†“
Phase 3 â€” Explain Strategy
 â†“
Build Response
 â†“
Cache Result

ğŸ” Caching Strategy

Hashes extracted meaning, not raw text

Prevents redundant computation

Recommended: also cache Phase 2 output for stability

ğŸ“¤ Final Output
{
  "best_move": "...",
  "focus": "...",
  "urgency": "...",
  "avoid": [...],
  "advice": "...",
  "reason": "...",
  "confidence": "..."
}

ğŸ§© Key Design Principles (Final)

Probabilistic â†’ Deterministic â†’ Explanatory

Schemas over trust

Enums over strings

LLMs never decide

â€œWaitâ€ is a valid strategy

Different runs â‰  bad reasoning

âœ… Current System State

Architecture: âœ… Final

Phase boundaries: âœ… Clean

Determinism: âœ… Guaranteed post-analysis

Explainability: âœ… High

Production hardening: ğŸŸ¡ In progress (retries, caching)
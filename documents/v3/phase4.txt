ğŸ”¹ Phase 4 â€” Controller / Orchestration Layer
ğŸ¯ Purpose

Coordinate the entire pipeline in a safe, repeatable, and cost-controlled way.

Phase 4 controls flow, not intelligence.

ğŸ“¥ Entry Points

handle_request(raw_text)

handle_request_from_business(business_id)

âš™ï¸ Pipeline Flow
Input
 â†“
Validation
 â†“
Phase 2 â€” Extract Signals
 â†“
Hash Structured Meaning
 â†“
Cache Lookup
 â†“
Phase 1 â€” Decide Strategy
 â†“
Phase 3 â€” Explain Strategy
 â†“
Build Final Decision JSON
 â†“
Cache Result

ğŸ” Caching Strategy

Cache key = hash of structured signals

Meaning-based, not text-based

Redis treated as optimization, not dependency

ğŸ“¤ Canonical Final Output
{
  "best_move": "...",
  "focus": "...",
  "urgency": "...",
  "avoid": [],
  "advice": "...",
  "reason": "...",
  "confidence": "..."
}
